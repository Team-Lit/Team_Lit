<div class="container item-index-box">
  <div class="row">
    <div class="col-ld-12">
      <div class="add-box">
        <h1 class="text-center">販売商品一覧</h1>
        
        <div>
          <%= link_to "新規商品追加", new_admin_admin_product_path, class: "btn btn-lg btn-default" %>
        </div>    
      </div>

      <%# <div class="text-center item-search-box">
        <%= search_form_for @q, class: 'mb-5' do |f| %>
        <%# <%= f.search_field :product_name, class: 'form-control' %>
        <%# <%= f.submit class: 'btn btn-outline-primary' %>
        <%# <% end %>
      <%# </div> %>
    <%# </div>  %>

    <h1></h1>
    <div class="row">
      <div class="col-lg-12">
        <table class="table">
          <tr>
            <th></th>
            <th>商品名</th>
            <th>アーティスト名</th>
            <th>価格</th>
            <th>在庫数</th>
            <th>販売ステータス</th>
            <th></th>
          </tr>

          <% @products.each do |product| %>

          <tr>
            <td><%= attachment_image_tag product, :jacket_image, size: "50x50", fallback: "no_image.jpg" %></td>
            <td><%= product.product_name %></td>
            <td><%= product.artist.artist_name %></td>
            <td><%= product.pre_tax_price %></td>
            <%# 計算式は購入までの流れが完了後導入 %>
            <td>
              <%= (Arrival.where(product_id: product.id).sum(:arrival_quantity)) %>枚
              <%# - (OrderDetail.where(product_id: id).sum(:quantity)) %>
            </td>
            <%# ひとまずの販売ステータス表示 %>
            <td>
              <%# <%= product.stock_status %>
              <% if (Arrival.where(product_id: product.id).sum(:arrival_quantity)) > 0 %>
                <p>販売中</p>
              <% else %>
                <p>在庫切れ</p>
              <% end %> 
            </td> 
            <td><%= link_to "詳細", admin_admin_product_path(product) %></td>
          </tr>
          <% end %>
        </table>
      </div>
    </div>
  </div>


</div>